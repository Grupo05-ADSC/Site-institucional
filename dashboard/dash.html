<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD - SISGUARD</title>

    <link rel="shortcut icon" href="./img/logoSISGUARD.png" type="image/x-icon">
    <link rel="stylesheet" href="dash.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="http://bernii.github.io/gauge.js/dist/gauge.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.4.0/justgage.min.js"></script>

</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <div class="lista-funcionarios" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Funcionários</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitListaFuncionarios()"></i>
            </div>

            <button class="btnCadastroF" onclick="openCadastroFuncionarios()">Cadastrar funcionários</button>

            <div class="legendaFuncionarios">
                <b class="id">ID</b>
                <b class="nome">Nome</b>
                <b class="email">E-mail</b>
                <b class="excluir">Excluir</b>
                <b class="editar">Editar</b>
            </div>

            <div class="conteudo" id="conteudo_funcionario">

                
            
            </div>
        </div>
    </div>

    <div class="cadastroFuncionarios" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Cadastrar Funcionários</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitCadastroFuncionarios()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p>Nome:</p>
                    <input type="text" id="nome_inputCadastro">
                    <p>E-mail:</p>
                    <input type="email" name="" id="email_inputCadastro">
                    <p>Senha:</p>
                    <input type="password" name="" id="senha_inputCadastro">
                    <p>Confirmar senha:</p>
                    <input type="password" name="" id="confirme_inputCadastro">

                </div>
                <button onclick="cadastrarFuncionario()" style="width: 40vh;" class="btnCadastro">Cadastrar funcionário</button>
            </div>

        </div>
    </div>

    <div class="cadastrarSlack_div" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Slack</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitCadastrarSlack()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p>ID do workspace ou colaborador</p>
                    <input type="email" name="" id="email_inputCadastroSlack">

                </div>
                <button onclick="cadastrarSlack()" style="width: 40vh;" class="btnCadastro">Cadastrar Slack</button>
            </div>
        </div>
    </div>

    <div class="editarFuncionarios" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Funcionário</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitEditarFuncionarios()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p>Nome:</p>
                    <input type="text" id="nome_input_funcionario" >
                    <p>E-mail:</p>
                    <input type="email" name="" id="email_input_funcionario">
                    <p>Nova senha:</p>
                    <input type="password" name="" id="senha_input_funcionario">
                    <p>Confirmar nova senha:</p>
                    <input type="password" name="" id="confirme_input_funcionario">
                </div>
                <button onclick="editar()" style="width: 40vh;" class="btnCadastro">Editar funcionário</button>
            </div>

        </div>
    </div>

    <div class="abrirPerfil" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Perfil</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitPerfil()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p><b>E-mail:</b></p>
                    <p>perfil@email.com</p>
                    <p><b>Senha:</b></p>
                    <p>********</p>
                </div>
                <button onclick="openEditarPerfil()" style="width: 40vh;" class="btnCadastro">Editar Perfil</button>
            </div>
        </div>
    </div>

    <div class="editarPerfil" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Perfil</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitPerfilOk()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p>E-mail:</p>
                    <input type="email" name="" id="email_input">
                    <p>Nova senha:</p>
                    <input type="password" name="" id="senha_input">
                    <p>Confirmar nova senha:</p>
                    <input type="password" name="" id="confirme_input">
                </div>
                <button onclick="editarPerfilOk()" style="width: 40vh;" class="btnCadastro">Editar Perfil</button>
            </div>

        </div>
    </div>

    <div class="sobrepor">
        <nav class="menuLateral">
            <div class="boxLogo">
                <img class="imagem" src="img/logoSISGUARD.png" alt="">
            </div>
            <div class="boxTitulo"> Olá, <span id="span_nome_empresa"></span>
            </div>
            <div class="menu">

                <div class="menuGraficos">
                
                    <div class="boxTextoMenu"><a href="dash.html">Gráficos</a></div>
                </div>

                <div class="menuGraficos">
                   
                    <div class="boxTextoMenu"><a href="dashGeral.html">Overview</a></div>
                </div>

                <div class="menuPerfil" onclick="">
                   
                    <div class="boxTextoMenu"> Dark store </div>
                </div>

                <div class="menuPerfil" onclick="">
                  
                    <div class="boxTextoMenu"> Máquinas </div>
                </div>

                <div class="menuPerfil" onclick="openListaFuncionarios()">
                    
                    <div class="boxTextoMenu"> Funcionários </div>
                </div>

                <div class="menuPerfil" onclick="openPerfil()">
                   
                    <div class="boxTextoMenu"> Perfil </div>
                </div>

                <div class="boxSair">
                    <div class="playSair">
                       
                        <b class="sair"><a class="voltar" href="../index.html">sair</a></b>
                    </div>
                </div>
            </div>
        </nav>

        <div class="linha1">
            <div class="box1">
                <select id="darkStoreSelect">
                 
                </select>
            </div>
            <div class="box1">
                <select id="computerSelect">
                    <option value="computer2">Máquina 1</option>
                    <option value="computer3">Máquina 2</option>
                    <option value="computer4">Máquina 3</option>
                    <option value="computer5">Máquina 4</option>
                    <option value="computer6">Máquina 5</option>
                </select>
            </div>
            <div class="box2">
                Total de Threads
                <h1>4</h1>
            </div>
            <div class="box2">
                Processos Abertos
                <h1>31</h1>
            </div>
            <div class="box3">
                <b id="titulo">Espaço de Disco</b>
                <div class="legenda">
                    <div class="legenda1"></div>disponivel
                    <div class="legenda2"></div>Usado
                </div>
                <canvas id="donutChart"></canvas>
            </div>
        </div>

        <div class="linha2">
            <div class="indicadores">
                <div class="cardMetrica">
                    <div class="legendaGauge">
                        <div class="legenda1"></div>Ótimo
                        <div class="legenda2"></div>Bom
                        <div class="legenda3"></div>Atenção
                        <div class="legenda4"></div>Alerta
                        <div class="legenda5"></div>Crítico
                    </div>
                    <div class="cardGauge">
                        <div class="box">
                            <span id="uso_atual1"></span>
                            <canvas id="gauge1" class="gauge">
                            </canvas>
                        </div>
                        <div class="box">
                            <span id="uso_atual2"></span>
                            <canvas id="gauge2" class="gauge"></canvas>

                           
                        </div>
                        <div class="box">
                            <span id="uso_atual3"></span>
                            <canvas id="gauge3" class="gauge"></canvas>

                        </div>
                    </div>
                </div>
                <div class="card_alerta">
                    <div class="titulo_icon">
                        <div class="titulo_alerta"><b>Notificações</b></div>
                    
                    </div>
                    <div class="box">
                        <b>CPU alterada</b> <br>
                        Descrição: o uso da sua cpu está acima do ideal

                        <button class="buttonSlack" onclick="openCadastrarSlack()">
                            Cadastrar slack
                        </button>
                    </div>
                </div>

            </div>



            <div class="boxgraficos">
                <div class="graficos">
                    <div class="grafico1">
                        <b id="titulo">Uso da CPU(%)</b>
                        <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart1"></canvas>
                        </div>
                    </div>
                    <div class="grafico1">
                        <b id="titulo">Uso do DISCO(%)</b>
                        <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart2"></canvas>
                        </div>
                    </div>
                </div>
                <div class="graficos">
                    <div class="grafico1">
                        <b id="titulo">Uso da RAM(%)</b>
                        <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart3"></canvas>
                        </div>
                    </div>
                    <div class="grafico1">
                        <div class="box">
                            <b id="titulo">Processos com consumo elevado</b>
                            <button class="button">Ver mais</button>
                            <table>
                                <thead>
                                    <tr>
                                        <th>PID</th>
                                        <th>%CPU</th>
                                        <th>%RAM</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>21</td>
                                        <td>12</td>
                                        <td>20</td>
                                    </tr>
                                    <tr>
                                        <td>22</td>
                                        <td>9</td>
                                        <td>20</td>
                                    </tr>
                                    <tr>
                                        <td>03</td>
                                        <td>5</td>
                                        <td>22</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart4"></canvas>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>

        <div class="linha3">
            <div class="box">
                <b>Total de Máquinas</b>
                <h1 class="destaque">24</h1>
            </div>
            <div class="box">
                <b>Máquinas Ativas</b>
                <h1 class="destaque">23</h1>
            </div>
            <div class="box">
                <b>Total de Funcionários</b>
                <h1 class="destaque">7</h1>
            </div>
        </div>

    </div>

</body>

</html>
<script defer>
    let nomeEmpresa = localStorage.NOME
    let idEmpresa = localStorage.ID

    
    var listaFuncionarios = document.querySelector('.lista-funcionarios');
    var cadastroFuncionarios = document.querySelector('.cadastroFuncionarios');
    var editarFuncionarios = document.querySelector('.editarFuncionarios');
    var abrirPerfil = document.querySelector('.abrirPerfil');
    var editarPerfil = document.querySelector('.editarPerfil');
    var cadastrarSlack_div = document.querySelector('.cadastrarSlack_div');
    var conteudo_funcionario = document.querySelector('#conteudo_funcionario');


    span_nome_empresa.innerHTML = `${nomeEmpresa}!`
    // POPUPS


    
    function mostrarDark() {
        try {
        fetch(`http://localhost:3000/mostrarDarkstore/${idEmpresa}`, {
            method:"GET",
            headers: {
                "Content-Type":"application/json"
            }
        }).then(resposta => resposta.json())
        .then(dados => {
            plotarDark(dados.resposta)
        })
    }catch(erro) {
        console.log(erro)
    }
    } 
    
    mostrarDark()


    function plotarDark(dados) {
        let selectDark = darkStoreSelect
        dados.map(item => {
            console.log(item)
            selectDark.innerHTML += `<option value=${item.idDarkstore}>${item.nome}</option>`
        })
    }
    
    const mostrarFuncionario = () => {
        if (idEmpresa === null || idEmpresa === 0) {
            
        }else  {
            fetch(`http://localhost:3000/funcionario/${idEmpresa}`, {
                method: "GET",
                headers : {
                    "Content-Type":"application/json"
                }
            }).then(resposta => resposta.json())
            .then(value => {
                conteudo_funcionario.innerHTML = "";
                value['resposta'].map(item => {

                conteudo_funcionario.innerHTML += `
                <div class="funcionario">
                    <div class="id">
                        <p>${item.idFuncionario}</p>
                    </div>
                    <div class="nome">
                        <p>${item.nomeFuncionario}</p>
                    </div>
                    <div class="email">
                        <p>${item.emailFuncionario}</p>
                    </div>
                    <div class="excluir">
                        <i onclick="excluirFuncionario(${item.idFuncionario})" class="fa fa-trash-o"
                            style="font-size:24px; display: flex; align-items: center;"></i>
                    </div>
                    <div class="editar">
                        <i onclick="openEditarFuncionarios(${item.idFuncionario})" class="fa fa-edit" style="font-size:24px; display: flex; align-items: center;"></i>
                    </div>
                </div>
                `
            })
            })
        }
    }

    mostrarFuncionario()

    const excluirFuncionario = (idFuncionario) => {
    fetch(`http://localhost:3000/deletarFuncionario/${idEmpresa}/${idFuncionario}`, {
        method: "DELETE",
        headers: {
            "Content-Type":"application/json"
        },
    }).then(function (resposta) {
        if(resposta.ok) {
            Swal.fire({
                title: 'Funcionario excluido!',
                icon: 'success',
                confirmButtonText: 'Ok'
            })
           mostrarFuncionario()
        }else {
            Swal.fire({
                confirmButtonText: 'Ok',
                icon: "error",
                title: "Erro ao excluir funcionario",
            });
        }
    }).catch(erro => {
        console.log(erro)
    })
}

    // function openListaFuncionarios() {
    //     listaFuncionarios.style.display = "flex"
    // }

    // function exitListaFuncionarios() {
    //     listaFuncionarios.style.display = "none"
    // }

    // GRAFICO DONUT

    // parte da table de processos




 
    const cadastrarFuncionario = () =>  {
    const nome = nome_inputCadastro.value
    const email = email_inputCadastro.value
    const senha = senha_inputCadastro.value
    const confirmar = confirme_inputCadastro.value

    if (nome === '' || email === '' || senha === '' || confirmar === '') {
        Swal.fire({
            color: "#ffffff",
            background: "#272628",
            confirmButtonColor: "#8039EB",
            icon: "error",
            title: "Oops...",
            text: "Preencha todos os campos",
        });
        return false
    } else if (senha != confirmar) {
        Swal.fire({
            color: "#ffffff",
            background: "#272628",
            confirmButtonColor: "#8039EB",
            icon: "warning",
            title: "Oops...",
            text: "As senhas precisam ser iguais",
        });
        return false
    }  else {
        fetch(`http://localhost:3000/cadastroFunc/${idEmpresa}`, {
            method:"POST",
            headers: {
                "Content-Type":"application/json"
            },
            body: JSON.stringify({
                nome:nome,
                email:email,
                senha:senha
            })
        }).then(function(resposta) {
            if(resposta.ok) {
                Swal.fire({
                        title: 'Cadastrado!',
                        icon: 'success',
                        confirmButtonText: 'Ok'
                    })
                    mostrarFuncionario()
            }else {
                Swal.fire({
                        title: 'Erro ao cadastrar',
                        icon: 'error',
                        confirmButtonText: 'Ok'
                    })
            }
        }).catch(erro => console.log(erro))
    }
}

function openEditarFuncionarios(idFuncionarioParams) {
        idFuncionario = idFuncionarioParams
        editarFuncionarios.style.display = "flex"
    }

const editarPerfilOk = () => {
    alert(idFuncionario)
    let nome = nome_input_funcionario.value
    let email = email_input_funcionario.value
    let senha = senha_input_funcionario.value
    let confirme = senha_input_funcionario.value

    if(nome === "" || email === "" || senha === "" || confirme === "") {
        Swal.fire({
                        title: 'Campos vazios',
                        icon: 'error',
                        confirmButtonText: 'Ok'
                    })
    }else {
        if(senha != confirme) {
            Swal.fire({
                        title: 'Senhas diferentes',
                        icon: 'error',
                        confirmButtonText: 'Ok'
                    })
        }else {
            fetch(`http://localhost:3000/atualizarFuncionario/${idEmpresa}/${idFuncionario}`, 
                {
            method:"POST",
            headers: {
                "Content-Type":"application/json"
            },
            body: JSON.stringify({
                nome:nome,
                email:email,
                senha:senha
            })
        }).then(function(resposta) {
            if(resposta.ok) {
                Swal.fire({
                        title: 'Alterado!',
                        icon: 'success',
                        confirmButtonText: 'Ok'
                    })
                    mostrarFuncionario()
            }else {
                Swal.fire({
                        title: 'Erro ao alterar',
                        icon: 'error',
                        confirmButtonText: 'Ok'
                    })
            }
        
            }).catch(erro => console.log(erro))
        }
    }
}

    //sweet alert
   
</script>
<script src="./js/plotarGrafico.js" defer></script>
<script src="./js/graficos.js"defer></script>
<script src="./js/Alerts.js"defer></script>
<script src="./js/gerenciarFuncionario.js"defer></script>
<script>
    let idFuncionario = 0
     function openCadastrarSlack() {
        cadastrarSlack_div.style.display = "flex"
    }

    function exitCadastrarSlack() {
        cadastrarSlack_div.style.display = "none"
    }

    function openListaFuncionarios() {
        listaFuncionarios.style.display = "flex"
    }

    function openPerfil() {
        abrirPerfil.style.display = "flex"
    }

    function exitPerfil(){
        abrirPerfil.style.display = "none"
    }

    function exitPerfilOk(){
        editarPerfil.style.display = "none"
        abrirPerfil.style.display = "none"
    }

    function exitListaFuncionarios() {
        listaFuncionarios.style.display = "none"
    }

    function openCadastroFuncionarios() {
        cadastroFuncionarios.style.display = "flex"
    }

    function exitCadastroFuncionarios() {
        cadastroFuncionarios.style.display = "none"
    }

 
    function openEditarPerfil() {
        editarPerfil.style.display = "flex"
    }

    function exitEditarFuncionarios() {
        editarFuncionarios.style.display = "none"
    }
</script>