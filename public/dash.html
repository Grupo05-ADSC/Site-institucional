<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD - SISGUARD</title>

    <link rel="shortcut icon" href="./img/logoSISGUARD.png" type="image/x-icon">
    <link rel="stylesheet" href="./css/dash.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="http://bernii.github.io/gauge.js/dist/gauge.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.4.0/justgage.min.js"></script>

</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!--lISTA DE FUNCIONARIOS-->
    <div class="lista-funcionarios" id="lista_funcionarios" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Funcionários</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitListaFuncionarios()"></i>
            </div>

            <button class="btnCadastroF" onclick="openCadastroFuncionarios()">Cadastrar funcionários</button>

            <div class="legendaFuncionarios">
                <b class="id">ID</b>
                <b class="nome">Nome</b>
                <b class="email">E-mail</b>
                <b class="excluir">Excluir</b>
                <b class="editar">Editar</b>
            </div>

            <div class="conteudo" id="conteudo_funcionario">



            </div>
        </div>
    </div>

    <div class="lista-funcionarios" id="lista_dark" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Dark Store</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitListaDark()"></i>
            </div>

            <button class="btnCadastroF" onclick="openCadastrarDark()">Cadastrar DarkStore</button>

            <div class="legendaFuncionarios">
                <b class="id">ID</b>
                <b class="nome">Nome</b>
                <b class="excluir">Excluir</b>
                <b class="editar">Editar</b>
            </div>

            <div class="conteudo" id="conteudo_darkStore">



            </div>
        </div>
    </div>

    <!--CADASTRO DE FUNCIONARIO -- MODAL -->
    <div class="cadastroFuncionarios" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Cadastrar Funcionários</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitCadastroFuncionarios()"></i>
            </div>

            <div class="conteudo">
                <div class="conteudo_principal_cadastroFuncionario">
                    <div class="div_separar_nome_and_cargo">
                        <div class="div_nome_funcionario_cadastroFuncionario">
                            <p>Nome:</p>
                            <input type="text" id="nome_inputCadastro">
                        </div>
                        <div class="div_cargo_funcionario_cadastroFuncionario">
                            <p>Cargo:</p>
                            <select name="" id="select_funcionario">
                                <option value="gerente">Gerente</option>
                                <option value="comum">Comum</option>
                            </select>
                        </div>
                    </div>
                    <p>E-mail:</p>
                    <input type="email" name="" id="email_inputCadastro">
                    <p>Senha:</p>
                    <input type="password" name="" id="senha_inputCadastro">
                    <p>Confirmar senha:</p>
                    <input type="password" name="" id="confirme_inputCadastro">

                </div>
                <button onclick="cadastrarFuncionario()" style="width: 40vh;" class="btnCadastro">Cadastrar
                    funcionário</button>
            </div>

        </div>
    </div>



       <!--lISTA DE MÁQUINAS-->
       <div class="lista-maquinas" id="lista_maquinas" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Máquinas</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitListaMaquinas()"></i>
            </div>

            <!-- <button class="btnCadastroF" onclick="openEditarMaquinas()">Editar Máquinas</button> -->

            <div class="legendaMaquinas">
                <b class="id">Darkstore</b>
                <b class="nome">Nome</b>
                <b class="excluir">Excluir</b>
                <b class="editar">Editar</b>
            </div>

            <div class="conteudo" id="conteudo_maquina">
            </div>
        </div>
    </div>


    <!--EDITAR MÁQUINA -- MODAL -->
    <div class="editarMaquinas" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Máquina</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitEditarMaquinas()"></i>
            </div>

            <div class="conteudo">
                    <p>Nome:</p>
                    <input type="text" id="nome_input_maquina">

                </div>
                <button onclick="editarMaquinaOk()" style="width: 40vh;" class="btnCadastro">Editar máquina</button>
            </div>

        </div>
    </div>

    <!-- LISTA DE MÉTRICAS -- MODAL -->
    <div class="lista-metricas" id="lista_metricas" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Métricas</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitListaMetricas()"></i>
            </div>

            <button class="btnCadastroF" onclick="openCadastroMetricas()">Cadastrar métrica</button>

            <div class="legendaMetricas">
                <b class="id">ID</b>
                <b class="alerta">Alerta</b>
                <b class="critico">Crítico</b>
                <b class="excluir">Excluir</b>
                <b class="editar">Editar</b>
            </div>

            <div class="conteudo" id="conteudo_metricas">
            </div>
        </div>
    </div>


    <!--CADASTRO DE MÉTRICAS -- MODAL -->
    <div class="cadastroMetricas" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Cadastrar Métricas</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitCadastroMetricas()"></i>
            </div>

            <div class="conteudo">
                <div class="conteudo_principal_cadastroMetricas">
                    <p>Alerta:</p>
                    <input type="number" name="" id="input_alertaMetrica">
                    <p>Crítico:</p>
                    <input type="number" name="" id="input_criticoMetrica">

                </div>
                <button onclick="cadastrarMetricas()" style="width: 40vh;" class="btnCadastro">Cadastrar
                    métrica</button>
            </div>

        </div>
    </div>

      <!--EDITAR MÁQUINA -- MODAL -->
      <div class="editarMetricas" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Métrica</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitEditarMetricas()"></i>
            </div>

                <div class="conteudo">
                    <p>Alerta:</p>
                    <input type="number" id="alerta_input_metricas">
                </div>
                <div class="conteudo">
                    <p>Crítico:</p>
                    <input type="number" id="critico_input_metricas">
                </div>
                <button onclick="editarMetricasOk()" style="width: 40vh;" class="btnCadastro">Editar métricas</button>
            </div>

        </div>
    </div>

    <!--CADASTRO DE DARK STORE-->
    <div class="cadastroFuncionarios" id="div_cadastro_darkStore" style="display: none;">
        <div class="pop-up" id="pop-up_cadastro_dark">
            <div class="header_pop-up">
                <div class="div_titulo_pop-up">
                    <h2>Cadastrar DarkStore</h2>
                </div>
                <div class="div_sair_pop-up">
                    <i class="fa fa-remove" id="icon_sair_pop-up" onclick="exitCadastroDark()"></i>

                </div>
            </div>
            <div class="div_conteudo_cadastrar_darkstore">
                <div class="div_principal_inputs_pop-up">
                    <div class="div_esquerdo_inputs_pop-up">
                        <p>Nome</p>
                        <input type="text" name="" id="nome_dark">
                    </div>
                    <div class="div_direito_inputs_pop-up">
                        <p>CEP</p>
                        <input type="text" id="cep" name="" id="" onchange="buscarCep()">
                    </div>
                </div>
                <div class="div_principal_inputs_pop-up">
                    <div class="div_esquerdo_inputs_pop-up">
                        <p>Estado</p>
                        <input type="text" name="" id="estado">
                    </div>
                    <div class="div_direito_inputs_pop-up">
                        <p>Cidade</p>
                        <input type="text" name="" id="cidade">
                    </div>
                </div>
                <div class="div_principal_inputs_pop-up">
                    <div class="div_esquerdo_inputs_pop-up">
                        <p>Bairro</p>
                        <input type="text" name="" id="bairro">
                    </div>
                    <div class="div_direito_inputs_pop-up">
                        <p>Rua</p>
                        <input type="text" name="" id="rua">
                    </div>
                </div>
                <div class="div_principal_inputs_pop-up">
                    <div class="div_esquerdo_inputs_pop-up">
                        <p>Número</p>
                        <input type="text" name="" id="numero_dark">
                    </div>
                    <div class="div_direito_inputs_pop-up" id="div_direito_button_pop-up">
                        <button onclick="cadastrarDark()">Cadastrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!--EDITAR DARK-->
    <div class="cadastroFuncionarios" id="div_editar_darkStore" style="display: none;">
        <div class="pop-up" id="pop-up_cadastro_dark">
            <div class="header_pop-up">
                <div class="div_titulo_pop-up">
                    <h2>Editar DarkStore</h2>
                </div>
                <div class="div_sair_pop-up">
                    <i class="fa fa-remove" id="icon_sair_pop-up" onclick="exitEditarDark()"></i>

                </div>
            </div>
            <div class="div_conteudo_cadastrar_darkstore">
                <div class="div_principal_inputs_pop-up">
                    <div class="div_esquerdo_inputs_pop-up">
                        <p>Nome</p>
                        <input type="text" name="" id="nome_dark_editar">
                    </div>
                    
                    <div class="div_direito_inputs_pop-up" id="div_direito_button_pop-up">
                        <button onclick="editarDark()">Editar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="cadastroFuncionarios" id="div_listar_processos" style="display: none;">
        <div class="pop-up" id="pop-up_cadastro_dark">
            <div class="header_pop-up" id="header_pop_up_processos">
                <div class="div_titulo_pop-up">
                    <h2>Processos da Maquina </h2>
                </div>
                <div class="div_sair_pop-up">
                    <i class="fa fa-remove" id="icon_sair_pop-up" onclick="closeProcessos()"></i>
                </div>
            </div>
            <div class="div_conteudo_processos">
                <table>
                    <thead>
                        <tr>
                            <th class="td_tirar_border">PID</th>
                            <th class="td_tirar_border">CPU %</th>
                            <th class="td_tirar_border">RAM %</th>
                            <th id="td_stop_func" class="td_tirar_border">STOP</th>
                        </tr>
                    </thead>

                    <tbody id="nova_tabela_processos_top10">
                        

                    </tbody>

                </table>
            </div>
        </div>
    </div>


    <div class="cadastrarSlack_div" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Slack</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitCadastrarSlack()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p>ID do workspace ou colaborador</p>
                    <input type="text" name="" id="inputCadastroSlack">

                </div>
                <button onclick="cadastrarSlack()" style="width: 40vh;" class="btnCadastro">Cadastrar Slack</button>
            </div>
        </div>
    </div>

    <div class="editarFuncionarios" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Funcionário</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitEditarFuncionarios()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p>Nome:</p>
                    <input type="text" id="nome_input_funcionario">
                    <p>E-mail:</p>
                    <input type="email" name="" id="email_input_funcionario">
                    <p>Nova senha:</p>
                    <input type="password" name="" id="senha_input_funcionario">
                    <p>Confirmar nova senha:</p>
                    <input type="password" name="" id="confirme_input_funcionario">
                </div>
                <button onclick="editarFuncionarioOk()" style="width: 40vh;" class="btnCadastro">Editar
                    funcionário</button>
            </div>

        </div>
    </div>

    <div class="abrirPerfil" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Perfil</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitPerfil()"></i>
            </div>

            <div class="conteudo" id="conteudo_div_funcionario">
                <div>
                    <p><b>E-mail:</b></p>
                    <p id="email_perfil">perfil@email.com</p>
                    <p><b>Senha:</b></p>
                    <p>********</p>
                </div>
                <button onclick="openEditarPerfil()" style="width: 40vh;" class="btnCadastro">Editar Perfil</button>
            </div>
        </div>
    </div>

    <div class="editarPerfil" style="display: none;">
        <div class="pop-up">
            <div class="head">
                <div class="titulo">
                    <h1>Editar Perfil</h1>
                </div>
                <i class="fa fa-remove" style="width: 6vh; font-size: 4vh;" onclick="exitPerfilOk()"></i>
            </div>

            <div class="conteudo">
                <div>
                    <p>E-mail:</p>
                    <input type="email" id="email_input_perfil">
                    <p>Nova senha:</p>
                    <input type="password" name="" id="senha_input_perfil">
                    <p>Confirmar nova senha:</p>
                    <input type="password" name="" id="confirme_input_perfil">
                </div>
                <button onclick="editarPerfilOk()" style="width: 40vh;" class="btnCadastro">Editar Perfil</button>
            </div>

        </div>
    </div>

    <div class="sobrepor">
        <nav class="menuLateral">
            <div class="boxLogo">
                <img class="imagem" src="./img/logoSISGUARD.png" alt="">
            </div>
            <div class="boxTitulo"> Olá, <span id="span_nome_empresa"></span>
            </div>
            <div class="menu">

                <div class="menuGraficos">

                    <div class="boxTextoMenu"><a href="dash.html">Gráficos</a></div>
                </div>

                <div class="menuGraficos" id="overview_options">

                    <div class="boxTextoMenu"><a href="dashGeral.html">Overview</a></div>
                </div>

                <div class="menuPerfil" onclick="" id="dark_options">

                    <div class="boxTextoMenu" onclick="openListaDark()"> Dark Store</div>
                </div>

                <div class="menuPerfil" onclick="openListaMetricas()" id="metricas_options">
                    <div class="boxTextoMenu"> Métricas ideais </div>
                </div>

                <div class="menuPerfil" onclick="openListaMaquinas()" id="maquinas_options">
                    <div class="boxTextoMenu"> Máquinas </div>
                </div>

                <div class="menuPerfil" onclick="openListaFuncionarios()" id="funcionarios_options">

                    <div class="boxTextoMenu"> Funcionários </div>
                </div>

                <div class="menuPerfil" onclick="openPerfil()" id="perfil_options">

                    <div class="boxTextoMenu"> Perfil </div>
                </div>

                <div class="boxSair">
                    <div class="playSair">

                        <b class="sair" onclick="Logout()"><a class="voltar">sair</a></b>
                    </div>
                </div>
            </div>
        </nav>

        <div class="linha1">
            <div class="box1">
                <select id="darkStoreSelect" onchange="mostrarMaquinas(this.value)">
                    <option value="0">Selecione uma DarkStore</option>

                </select>
            </div>
            <div class="box1">
                <select id="computerSelect" onchange="plotarGraficos(this.value)">
                    <option value="0">Selecione uma máquina</option>
                   
                </select>
            </div>
            <div class="box2" id="div_total_threads">
                Componentes
                <h1 id="total_threads">0</h1>
            </div>
            <div class="box2" id="div_total_processos">
                Processos Abertos
                <h1 id="processos_abertos">0</h1>
            </div>
            <div class="box3">
                <b id="titulo">Espaço de Disco</b>
                <div class="legenda">
                    <div class="legenda1"></div>Usado
                    <div class="legenda2"></div>Disponivel
                </div>
                <canvas id="donutChart"></canvas>
            </div>
        </div>

        <div class="linha2">
            <div class="indicadores">
                <div class="cardMetrica">
                    <div class="legendaGauge">
                        <div class="legenda1"></div>Ótimo
                        <div class="legenda2"></div>Bom
                        <div class="legenda3"></div>Atenção
                        <div class="legenda4"></div>Alerta
                        <div class="legenda5"></div>Crítico
                    </div>
                    <div class="cardGauge">
                        <div class="box">
                            <span id="uso_atual1"></span>
                            <canvas id="gauge1" class="gauge">
                            </canvas>
                        </div>
                        <div class="box">
                            <span id="uso_atual2"></span>
                            <canvas id="gauge2" class="gauge"></canvas>


                        </div>
                        <div class="box">
                            <span id="uso_atual3"></span>
                            <canvas id="gauge3" class="gauge"></canvas>

                        </div>
                    </div>
                </div>
                <div class="card_alerta">
                    <div class="titulo_icon">
                        <div class="titulo_alerta"><b>Notificações</b></div>

                    </div>
                    <div class="box">
                        <b>CPU alterada</b> <br>
                        Descrição: o uso da sua cpu está acima do ideal

                        <button class="buttonSlack" onclick="openCadastrarSlack()">
                            Gerenciar slack
                        </button>
                    </div>
                </div>

            </div>



            <div class="boxgraficos">
                <div class="graficos">
                    <div class="grafico1">
                        <b id="titulo">Uso da CPU(%)</b>
                        <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart1"></canvas>
                        </div>
                    </div>
                    <div class="grafico1">
                        <b id="titulo">Uso do DISCO(%)</b>
                        <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart2"></canvas>
                        </div>
                    </div>
                </div>
                <div class="graficos">
                    <div class="grafico1">
                        <b id="titulo">Uso da RAM(%)</b>
                        <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart3"></canvas>
                        </div>
                    </div>
                    <div class="grafico1">
                        <div class="box">
                            <b id="titulo">Processos com consumo elevado</b>
                            <button class="button" onclick="openProcessos()">Ver mais</button>
                            <table>
                                <thead>
                                    <tr>
                                        <th>PID</th>
                                        <th>%CPU</th>
                                        <th>%RAM</th>
                                    </tr>
                                </thead>
                                <tbody id="nova_tabela_processos_top3">
                                    <!-- Linhas da tabela serão inseridas aqui -->
                                </tbody>
                            </table>
                        </div>
                        <!-- <div style="width: 90%; height: 85%; margin: 0px 0px 0px 40px;">
                            <canvas id="lineChart4"></canvas>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>

        <div class="linha3">
            <div class="box">
                <b>Total de Máquinas</b>
                <span class="destaque" id="total_maquinas">0</span>
            </div>
            <div class="box" id="maquina_ativas_div">
                <b>Máquinas Ativas</b>
                <span class="destaque" id="maquinas_ativas">0</span>
            </div>
            <div class="box">
                <b>Total de Funcionários</b>
                <span class="destaque" id="total_funcionario">0</span>
            </div>
        </div>

    </div>

</body>

</html>
<script defer>

    let nome = localStorage.NOME
    let qtdFunc = localStorage.QTDFUNC
    let qtdMac = localStorage.QTDMAC

    let macAtivas = localStorage.MACATIVAS
    let totalThreads = localStorage.TOTALTHREADS
    let processosAbertos = localStorage.PROCESSOSABERTOS
    total_funcionario.innerHTML = `${qtdFunc}` || ''
    // total_maquinas.innerHTML = `${qtdMac}` || ''
    // maquinas_ativas.innerHTML = `${macAtivas}` || ''

    let nomeEmpresa = localStorage.NOME
    let idEmpresa = localStorage.ID_EMPRESA
    let email = localStorage.EMAIL
    let email2 = localStorage.EMAIL
    let senha = localStorage.SENHA
    let cargo = localStorage.CARGO || ''

    let idDark;
    let idMaquina
    var listaFuncionarios = document.querySelector('#lista_funcionarios');
    var listaMaquinas = document.querySelector('#lista_maquinas');
    var editarMaquinas = document.querySelector('.editarMaquinas');
    var listaMetricas = document.querySelector('#lista_metricas');
    var cadastroMetricas = document.querySelector('.cadastroMetricas');
    var editarMetricas = document.querySelector('.editarMetricas');
    var listaDark = document.querySelector('#lista_dark');
    var cadastroFuncionarios = document.querySelector('.cadastroFuncionarios');
    var editarFuncionarios = document.querySelector('.editarFuncionarios');
    var abrirPerfil = document.querySelector('.abrirPerfil');
    var editarPerfil = document.querySelector('.editarPerfil');
    var cadastrarSlack_div = document.querySelector('.cadastrarSlack_div');

    let idMetricas

    var conteudo_funcionario = document.querySelector('#conteudo_funcionario');
    var td_stop_func = document.querySelector('#td_stop_func');
    var td_button_processo = document.querySelector('.td_button_processo');

    span_nome_empresa.innerHTML = `${nomeEmpresa}!`

    email_perfil.innerHTML = `${email}`


    function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    let regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

window.onload = function() {
    // Tenta obter o idMaquina e idDark da URL
    let idMaquina = getParameterByName('idMaquina');
    let idDark = getParameterByName('idDark');

    // Se não encontrar na URL, tenta obter do sessionStorage
    if (!idMaquina) {
        idMaquina = sessionStorage.getItem('ID_MAQUINA');
    }
    if (!idDark) {
        idDark = sessionStorage.getItem('ID_DARK');
    }

    if (idMaquina) {
        plotarGraficos(idMaquina)
    } else {
        console.log("ID da Máquina não encontrado.");
    }

    if (idDark) {
        console.log("ID Darkstore:", idDark);
    } else {
        console.log("ID da Darkstore não encontrado.");
    }
}


    function funcionarioTotais() {
  
        if (cargo === "") {
            fetch(`http://localhost:3000/funcionariosTotais/${idEmpresa}`, {
                method: "GET"
            }).then(resposta => resposta.json())
                .then(item => {
                    localStorage.QTDFUNC = quantidadeFuncionario = item["resposta"][0]["COUNT(*)"]

                    total_funcionario.innerHTML = `${quantidadeFuncionario}`
                })
        } else if (cargo == "gerente") {
            fetch(`http://localhost:3000/funcionariosTotais/${idEmpresa}`, {
                method: "GET"
            }).then(resposta => resposta.json())
                .then(item => {
                    localStorage.QTDFUNC = quantidadeFuncionario = item["resposta"][0]["COUNT(*)"]

                    total_funcionario.innerHTML = `${quantidadeFuncionario}`
                })
            dark_options.style.display = "none"

        } else if (cargo === "comum") {
            total_funcionario.style.display = "none";
            td_button_processo.style.display = "none";
            td_stop_func.style.display = "none"
            dark_options.style.display = "none";
            perfil_options.style.display = "none";
            maquinas_options.style.display = "none";
            metricas_options.style.display = "none";
            funcionarios_options.style.display = "none";
            total_funcionario_div.style.display = "none";
            overview_options.style.display = "none";
        }else if (cargo === "comum") {
            perfil_options.style.display = "none";
        }
    }

    funcionarioTotais()
    function mostrarDark() {
        try {
            fetch(`http://localhost:3000/mostrarDarkstore/${idEmpresa}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(resposta => resposta.json())
                .then(dados => {
                    console.log(dados)
                    plotarDark(dados.resposta)
            
                })
        } catch (erro) {
            console.log(erro)
        }
    }

    mostrarDark()

function salvarDark(){
    let selectDark = document.getElementById('darkStoreSelect');
    localStorage.DARK = selectDark.value;
}

function mostrarMaquinas(idDarkstore) {
    if (idDarkstore === "0") {
        document.getElementById('computerSelect').innerHTML = '<option value="0">Selecione uma máquina</option>';
        return;
    }

    try {
        fetch(`http://localhost:3000/maquinas/${idDarkstore}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(resposta => {
            if (!resposta.ok) {
                console.log('Deu erro ao pegar maquinas');
            } else {
                return resposta.json();
            }
        })
        .then(dados => {
            let computerSelect = document.getElementById('computerSelect');
            computerSelect.innerHTML = '<option value="0">Selecione uma máquina</option>';
            let dadosAtualizados =dados['resposta']
    
            dadosAtualizados.forEach(item => {
                computerSelect.innerHTML += `<option value="${item.idMaquina}">${item.nomeMaquina || item.numSerie}</option>`;
            });
        })
        .catch(error => {
            console.log('Erro ao processar os dados:', error);
        });
    } catch (erro) {
        console.log(erro);
    } 
}
    let idDarkStore
    function plotarDark(dados) {
    if (cargo === "" || cargo === "gerente") {
        let selectDark = document.getElementById('darkStoreSelect');
        selectDark.innerHTML = '<option value="0">Selecione uma DarkStore</option>';  // Adiciona a opção padrão
        dados.forEach(item => {
            idDarkStore = item.idDarkstore
        
            selectDark.innerHTML += `<option value="${item.idDarkstore}">${item.nome}</option>`;
        });
    } else {
        document.getElementById('darkStoreSelect').innerHTML = `<option>Não autorizado</option>`;
    }
}
    function mostrarFuncionario () {

        fetch(`http://localhost:3000/mostrarfuncionario/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(resposta => resposta.json())
            .then(value => {

                conteudo_funcionario.innerHTML = "";
                value['resposta'].map(item => {

                    conteudo_funcionario.innerHTML += `
                <div class="funcionario">
                    <div class="id">
                        <p>${item.idFuncionario}</p>
                    </div>
                    <div class="nome">
                        <p>${item.nomeFuncionario}</p>
                    </div>
                    <div class="email">
                        <p>${item.emailFuncionario}</p>
                    </div>
                    <div class="excluir">
                        <i onclick="excluirFuncionario(${item.idFuncionario})" class="fa fa-trash-o"
                            style="font-size:24px; display: flex; align-items: center;"></i>
                    </div>
                    <div class="editar">
                        <i onclick="openEditarFuncionarios(${item.idFuncionario}, '${item.nomeFuncionario}', '${item.emailFuncionario}')" class="fa fa-edit" style="font-size:24px; display: flex; align-items: center;"></i>
                    </div>
                </div>
                `
                })
            })
    }


    mostrarFuncionario()

    // function excluirFuncionario(idFuncionario) {
    //     fetch(`http://localhost:3000/deletarFuncionario/${idEmpresa}/${idFuncionario}`, {
    //         method: "DELETE",
    //         headers: {
    //             "Content-Type": "application/json"
    //         },
    //     }).then(function (resposta) {
    //         if (resposta.ok) {
    //             Swal.fire({
    //                 title: 'Funcionario excluido!',
    //                 icon: 'success',
    //                 confirmButtonText: 'Ok'
    //             })
    //             mostrarFuncionario()
    //             funcionarioTotais()
    //         } else {
    //             Swal.fire({
    //                 confirmButtonText: 'Ok',
    //                 icon: "error",
    //                 title: "Erro ao excluir funcionario",
    //             });
    //         }
    //     }).catch(erro => {
    //         console.log(erro)
    //     })
    // }

    // function openListaFuncionarios() {

    //     listaFuncionarios.style.display = "flex"
    // }

    // function exitListaFuncionarios() {
    //     listaFuncionarios.style.display = "none"
    // }

    // GRAFICO DONUT

    // parte da table de processos




mostrarFuncionario()
    var fkEmpresa = idEmpresa
    function excluirFuncionario(idFuncionario) {
    fetch(`http://localhost:3000/deletarFuncionario/${fkEmpresa}/${idFuncionario}`, {
        method: "DELETE",
        headers : {
            "Content-type" : "application/json"
        }
    })
    .then(response => {
        if (response.ok) {
            Swal.fire({
                    title: 'Funcionario excluido!',
                    icon: 'success',
                    confirmButtonText: 'Ok'
                })
                mostrarFuncionario()
                funcionarioTotais() 
                setTimeout(() => {
                    window.location.reload()
                }, 2000);
        } else {
            console.log("Erro ao deletar funcionário");
            Swal.fire({
                    confirmButtonText: 'Ok',
                    icon: "error",
                    title: "Erro ao excluir funcionario",
                });
        }
    })
    .catch(error => console.error("Erro:", error));
}

    function cadastrarFuncionario () {
        const nome = nome_inputCadastro.value
        const email = email_inputCadastro.value
        const senha = senha_inputCadastro.value
        const confirmar = confirme_inputCadastro.value
        const cargo = select_funcionario.value

        if (nome === '' || email === '' || senha === '' || confirmar === '' || cargo === "") {
            Swal.fire({
                color: "#ffffff",
                background: "#272628",
                confirmButtonColor: "#8039EB",
                icon: "error",
                title: "Oops...",
                text: "Preencha todos os campos",
            });
            return false
        } else if (senha != confirmar) {
            Swal.fire({
                color: "#ffffff",
                background: "#272628",
                confirmButtonColor: "#8039EB",
                icon: "warning",
                title: "Oops...",
                text: "As senhas precisam ser iguais",
            });
            return false
        } else {
            fetch(`http://localhost:3000/cadastroFunc/${idEmpresa}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    nome: nome,
                    email: email,
                    senha: senha,
                    cargo: cargo
                })
            }).then(function (resposta) {
                if (resposta.ok) {
                    Swal.fire({
                        title: 'Cadastrado!',
                        icon: 'success',
                        confirmButtonText: 'Ok'
                    })
                    mostrarFuncionario()
                    funcionarioTotais()
                } else {
                    Swal.fire({
                        title: 'Erro ao cadastrar',
                        icon: 'error',
                        confirmButtonText: 'Ok'
                    })
                }
            }).catch(erro => console.log(erro))
        }
    }
 

    function openEditarFuncionarios(idFuncionarioParams, nome, email) {
        nome_input_funcionario.value = nome
        email_input_funcionario.value = email
        idFuncionario = idFuncionarioParams
        editarFuncionarios.style.display = "flex"
    }
   
    function openEditarMetricas(idMetricaIdeal) {
        idMetricas = idMetricaIdeal
        alerta_input_metricas.value = nome
        critico_input_metricas.value = email
        editarMetricas.style.display = "flex"
    }

    const editarFuncionarioOk = () => {
        let nome = nome_input_funcionario.value
        let email = email_input_funcionario.value
        let senha = senha_input_funcionario.value
        let confirme = senha_input_funcionario.value

        if (nome === "" || email === "" || senha === "" || confirme === "") {
            Swal.fire({
                title: 'Campos vazios',
                icon: 'error',
                confirmButtonText: 'Ok'
            })
        } else {
            if (senha != confirme) {
                Swal.fire({
                    title: 'Senhas diferentes',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                })
            } else {
                fetch(`http://localhost:3000/atualizarFuncionario/${idEmpresa}/${idFuncionario}`,
                    {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            nome: nome,
                            email: email,
                            senha: senha
                        })
                    }).then(function (resposta) {
                        if (resposta.ok) {
                            Swal.fire({
                                title: 'Alterado!',
                                icon: 'success',
                                confirmButtonText: 'Ok'
                            })
                            // mostrarFuncionario()

                            // nome_input_funcionario.innerHTML = ""
                            // email_input_funcionario.innerHTML = ""
                            // senha_input_funcionario.innerHTML = ""
                            // senha_input_funcionario.innerHTML = ""
                            setTimeout(() => {
                        location.href = "dash.html";
                    }, 2000);
                        } else {
                            Swal.fire({
                                title: 'Erro ao alterar',
                                icon: 'error',
                                confirmButtonText: 'Ok'
                            })
                        }

                    }).catch(erro => console.log(erro))
            }
        }
    }

    const editarPerfilOk = () => {
        let email1 = email_input_perfil.value
        let senha = senha_input_perfil.value
        let confirmar = confirme_input_perfil.value

        if (email1 === "" || senha === "" || confirmar === "") {
            Swal.fire({
                title: 'Campos vazios',
                icon: 'error',
                confirmButtonText: 'Ok'
            })
        } else {
            if (senha != confirmar) {
                Swal.fire({
                    title: 'Senhas diferentes',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                })
            } else {
                fetch(`http://localhost:3000/editarPerfil/${idEmpresa}`,
                    {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            senha: senha,
                            email: email1,
                        })
                    }).then(function (resposta) {
                        if (resposta.ok) {
                            Swal.fire({
                                title: 'Alterado!',
                                icon: 'success',
                                confirmButtonText: 'Ok'
                            })
                            // email_perfil.innerHTML = email1;
                            localStorage.EMAIL = email1
                            setTimeout(() => {
                        location.href = "dash.html";
                    }, 2000);

                        } else {
                            Swal.fire({
                                title: 'Erro ao alterar',
                                icon: 'error',
                                confirmButtonText: 'Ok'
                            })
                        }

                    }).catch(erro => console.log(erro))
            }
        }
    }



    function Logout () {
        localStorage.NOME = ''
        localStorage.ID = ''
        localStorage.EMAIL = ""
        localStorage.CARGO = ''

        document.location.href = "../login.html"
    }

    function exibirListaDark() {
        if (idEmpresa === null || idEmpresa === 0) {

        } else {
            fetch(`http://localhost:3000/mostrarDarkstore/${idEmpresa}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(resposta => resposta.json())
                .then(value => {
        
                    conteudo_darkStore.innerHTML = "";
                    value['resposta'].map(item => {

                        conteudo_darkStore.innerHTML += `
                <div class="funcionario">
                    <div class="id">
                        <p>${item.idDarkstore}</p>
                    </div>
                    <div class="nome">
                        <p>${item.nome}</p>
                    </div>
                    <div class="excluir">
                        <i onclick="excluirDark(${item.idDarkstore})" class="fa fa-trash-o"
                            style="font-size:24px; display: flex; align-items: center;"></i>
                    </div>
                    <div class="editar">
                        <i onclick="editarDarkOk(${item.idDarkstore}, '${item.nome}')" class="fa fa-edit" style="font-size:24px; display: flex; align-items: center;"></i>
                    </div>
                </div>
                `
                    })
                })
        }
    }
    // exibirListaDark()

    const buscarCep = () => {
        var cep = document.querySelector('#cep').value;
        if (cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                method: "GET",
                headers: {
                    "Content-type": "application/json"
                }
            })
                .then(resposta => resposta.json())
                .then(item => {
            
                    var rua = document.querySelector('#rua').value = item.logradouro;
                    var estado = document.querySelector('#estado').value = item.uf;
                    var bairro = document.querySelector('#bairro').value = item.bairro;
                    var cidade = document.querySelector('#cidade').value = item.localidade;

                }).catch(error => {
                    console.error('Erro ao buscar CEP:', error);
                });
        }
    }

    
    function cadastrarDark() { // Certifique-se de passar idEmpresa como argumento
    let idEmpresa = localStorage.ID_EMPRESA;
    var nome = document.querySelector('#nome_dark').value;
    var rua = document.querySelector('#rua').value;
    var cep1 = document.querySelector('#cep').value;
    var estado = document.querySelector('#estado').value;
    var bairro = document.querySelector('#bairro').value;
    var cidade = document.querySelector('#cidade').value;
    var numero = document.querySelector('#numero_dark').value;
    var cep = cep1.replace(/-/g, '');

    if (nome === "" || rua === "" || cep === "" || estado === "" ||
        bairro === "" || cidade === "" || numero === "") {
        Swal.fire({
            color: "#ffffff",
            background: "#272628",
            confirmButtonColor: "#8039EB",
            icon: "error",
            title: "Oops...",
            text: "Preencha todos os campos",
        });
    } else {
        fetch(`http://localhost:3000/darkstore/cadastrarDark/${idEmpresa}`, { // Ajuste no endpoint
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nome: nome,
                rua: rua,
                cep: cep,
                estado: estado,
                bairro: bairro,
                cidade: cidade,
                numero: numero,
          
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                Swal.fire({
                    title: 'Cadastrado!',
                    icon: 'success',
                    confirmButtonText: 'Ok'
                })

                setTimeout(() => {
                        location.href = "dash.html";
                    }, 2000);
                // exibirListaDark(); // Certifique-se de que esta função está definida
            } else {
                Swal.fire({
                    title: 'Erro ao cadastrar',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                })
            }
        }).catch(erro => {
            console.log(erro);
            Swal.fire({
                title: 'Erro de conexão',
                icon: 'error',
                confirmButtonText: 'Ok'
            });
        })
    }
}


    function excluirDark(idDark) {
        console.log("excluir dark");
        fetch(`http://localhost:3000/deletarDark/${idEmpresa}/${idDark}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            },
        }).then(function (resposta) {
            if (resposta.ok) {
                Swal.fire({
                    title: 'Dark Store excluido!',
                    icon: 'success',
                    confirmButtonText: 'Ok'
                })

                setTimeout(() => {
                        location.href = "dash.html";
                    }, 3000);
                // exibirListaDark()
            } else {
                Swal.fire({
                    confirmButtonText: 'Ok',
                    icon: "error",
                    title: "Erro ao excluir Dark Store",
                });
            }
        }).catch(erro => {
            console.log(erro)
        })
    }

    function editarDarkOk(idDarkParams, nome) {
        nome_dark_editar.value = nome;
        idDark = idDarkParams
        div_editar_darkStore.style.display = "flex"
    }

    const editarDark = () => {
        // var nome = document.querySelector('#nome_dark_editar').value;
        var nome1 = nome_dark_editar.value;
  
        if (nome1 === "") {

            Swal.fire({
                color: "#ffffff",
                background: "#272628",
                confirmButtonColor: "#8039EB",
                icon: "error",
                title: "Oops...",
                text: "Preencha todos os campos",
            });
        } else {
            fetch(`http://localhost:3000/atualizarDark/${idEmpresa}/${idDark}`,
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        nome: nome1,
                    })
                }).then(function (resposta) {
                    if (!resposta.ok) {
                        Swal.fire({
                            title: 'Alterado!',
                            icon: 'success',
                            confirmButtonText: 'Ok'
                        })

                        setTimeout(() => {
                        location.href = "dash.html";
                    }, 2000);
                       
                    } else {
                        Swal.fire({
                            title: 'Erro ao alterar',
                            icon: 'error',
                            confirmButtonText: 'Ok'
                        })
                    }

                }).catch(erro => console.log(erro))
        }
    }


function mostrarMaquina() {
    
// console.log("entrou na função");
    fetch(`http://localhost:3000/maquinass/${idEmpresa}`, {
        method: "GET",
        headers: {
            "Content-Type": "application/json"
        }
    }).then(resposta => resposta.json())
    .then(value => { 
        conteudo_maquina.innerHTML = "";
        // value.forEach(item => {
        value['resposta'].forEach(item => {

            conteudo_maquina.innerHTML += `
        <div class="maquina">
            <div class="id">
                <p>${item.nome}</p>
            </div>
            <div class="nome">
                <p>${item.nomeMaquina}</p>
            </div>
            <div class="excluir">
                <i onclick="excluirMaquina(${item.idMaquina})" class="fa fa-trash-o"
                style="font-size:24px; display: flex; align-items: center;"></i>
                    </div>
            <div class="editar">
                <i onclick="openEditarMaquinas(${item.idMaquina},'${item.nomeMaquina}')" class="fa fa-edit" style="font-size:24px; display: flex; align-items: center;"></i>
            </div>
        </div>
        `
        })
    })
}

        // mostrarMaquina()

function openEditarMaquinas(idMaquinaParams, nome) {
    nome_input_maquina.value = nome;
    idMaquina = idMaquinaParams
    editarMaquinas.style.display = "flex"
}


const editarMaquinaOk = () => {
    let nome1 = nome_input_maquina.value
    // let idMaquina = id_maquina
    // idMaquina = idMaquinaParams


    if (nome1 === "") {
        Swal.fire({
            title: 'Campo vazio',
            icon: 'error',
            confirmButtonText: 'Ok'
        })
    } else {
            fetch(`http://localhost:3000/atualizarMaquina/${idMaquina}`,
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        nome: nome1,
                    })
                }).then(function (resposta) {
                    if (!resposta.ok) {
                        Swal.fire({
                            title: 'Nome alterado!',
                            icon: 'success',
                            confirmButtonText: 'Ok'
                        })
                        // mostrarMaquina()
                        setTimeout(() => {
                        location.href = "dash.html";
                    }, 2000);
                        // nome_input_maquina.innerHTML = ""
                    } else {
                        Swal.fire({
                            title: 'Erro ao alterar',
                            icon: 'error',
                            confirmButtonText: 'Ok'
                        })
                    }

                }).catch(erro => console.log(erro))
        }
    }

        
function excluirMaquina(idMaquina) {
    fetch(`http://localhost:3000/deletarMaquina/${idMaquina}`, {
        method: "DELETE",
        headers: {
            "Content-Type": "application/json"
        },
    }).then(function (resposta) {
        if (resposta.ok) {
            Swal.fire({
                title: 'Máquina excluida!',
                icon: 'success',
                confirmButtonText: 'Ok'
            })
            setTimeout(() => {
                        location.href = "dash.html";
                    }, 2000);
            // exibirListaMaquina()
        } else {
            Swal.fire({
                confirmButtonText: 'Ok',
                icon: "error",
                title: "Erro ao excluir máquina",
            });
        }
    }).catch(erro => {
        console.log(erro)
    })
}

function plotarGraficos(idMaquina) {
    idGrafico = idMaquina
    fetch(`http://localhost:3000/pegarDados/${idMaquina}`, {
        method: "GET",
        headers: {
            "Content-type": "application/json"
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
    
        if (data.length > 0) {
            const registrosCPU = data.filter(item => item.nomeComponente === "CPU");
            const registrosDISCO = data.filter(item => item.nomeComponente === "Disco");
            const registrosRAM = data.filter(item => item.nomeComponente === "Memoria Ram");

            const ultimoRegistroCPU = registrosCPU[0];
            const ultimoRegistroDISCO = registrosDISCO[0];
            const ultimoRegistroRAM = registrosRAM[0];

            if (ultimoRegistroCPU) {
                let dadoRegistroCPU = ultimoRegistroCPU.dadoRegistro;
            
                updateCPUData(lineChart1, dadoRegistroCPU);
                atualizarValorCPU(dadoRegistroCPU);
            }

            if (ultimoRegistroDISCO) {
                let dadoRegistroDISCO = ultimoRegistroDISCO.dadoRegistro;
    
                updateDiskData(lineChart2, dadoRegistroDISCO);
                updateDiskDataDonut(donutChart, dadoRegistroDISCO);
                atualizarValorDisco(dadoRegistroDISCO); 
            }

            if (ultimoRegistroRAM) {
                let dadoRegistroRAM = ultimoRegistroRAM.dadoRegistro;
    
                updateRAMData(lineChart3, dadoRegistroRAM);
                atualizarValorRAM(dadoRegistroRAM); 
            }
            mostrarMetricas()
            mostrarTotalMaquinas()
            funcionarioTotais()
             processos_abertos.innerHTML = `10`
            total_threads.innerHTML = `3`
            }
    })
    .catch(error => {
        console.error('Erro ao buscar dados:', error); 
    });
}

function updateCPUData(chart, data) {
    var time = new Date().toLocaleTimeString();

    chart.data.labels.push(time);
    if (chart.data.labels.length > 10) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }
    chart.data.datasets[0].data.push(parseFloat(data));
    chart.update();
}

function updateDiskData(chart, data) {
    var time = new Date().toLocaleTimeString();

    chart.data.labels.push(time);
    if (chart.data.labels.length > 10) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }
    chart.data.datasets[0].data.push(parseFloat(data));
    chart.update();
}

function updateDiskDataDonut(chart, data) {

    const used = parseFloat(data);
    const remaining = 100 - used;

    chart.data.datasets[0].data = [used, remaining];

    chart.update();
}

function updateRAMData(chart, data) {
    var time = new Date().toLocaleTimeString();

    chart.data.labels.push(time);
    if (chart.data.labels.length > 10) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }
    chart.data.datasets[0].data.push(parseFloat(data));
    chart.update();
}

var opts1 = {
    angle: 0,
    lineWidth: 0.5,
    radiusScale: 0.8,
    pointer: {
        length: 0.7,
        strokeWidth: 0.04,
        color: '#00000'
    },
    generateGradient: true,
    highDpiSupport: true,
    staticZones: [
        { strokeStyle: "#1EA614", min: 0, max: 30 },
        { strokeStyle: "#9FCC00", min: 30, max: 50 },
        { strokeStyle: "#FFF001", min: 50, max: 70 },
        { strokeStyle: "#FFAF00", min: 70, max: 90 },
        { strokeStyle: "#FE2B00", min: 90, max: 100 }
    ],
    staticLabels: {
        font: "12px sans-serif",
        labels: [0, 30, 50, 70, 90, 100],
        color: "#b6b6b6",
        fractionDigits: 0
    }
};

var target1 = document.getElementById('gauge1');
var gauge1 = new Gauge(target1).setOptions(opts1);
gauge1.maxValue = 100;
gauge1.setMinValue(0);
gauge1.animationSpeed = 32;

var opts2 = {
    angle: 0,
    lineWidth: 0.5,
    radiusScale: 0.8,
    pointer: {
        length: 0.7,
        strokeWidth: 0.04,
        color: '#00000'
    },
    generateGradient: true,
    highDpiSupport: true,
    staticZones: [
        { strokeStyle: "#1EA614", min: 0, max: 40 },
        { strokeStyle: "#9FCC00", min: 40, max: 60 },
        { strokeStyle: "#FFF001", min: 60, max: 80 },
        { strokeStyle: "#FFAF00", min: 80, max: 90 },
        { strokeStyle: "#FE2B00", min: 90, max: 100 }
    ],
    staticLabels: {
        font: "12px sans-serif",
        labels: [0, 40, 60, 80, 90, 100],
        color: "#b6b6b6",
        fractionDigits: 0
    }
};

var target2 = document.getElementById('gauge2');
var gauge2 = new Gauge(target2).setOptions(opts2);
gauge2.maxValue = 100;
gauge2.setMinValue(0);
gauge2.animationSpeed = 32;

var opts3 = {
    angle: 0,
    lineWidth: 0.5,
    radiusScale: 0.8,
    pointer: {
        length: 0.7,
        strokeWidth: 0.04,
        color: '#00000'
    },
    generateGradient: true,
    highDpiSupport: true,
    staticZones: [
        { strokeStyle: "#1EA614", min: 0, max: 40 },
        { strokeStyle: "#9FCC00", min: 40, max: 60 },
        { strokeStyle: "#FFF001", min: 60, max: 80 },
        { strokeStyle: "#FFAF00", min: 80, max: 90 },
        { strokeStyle: "#FE2B00", min: 90, max: 100 }
    ],
    staticLabels: {
        font: "12px sans-serif",
        labels: [0, 40, 60, 80, 90, 100],
        color: "#b6b6b6",
        fractionDigits: 0
    }
};

var target3 = document.getElementById('gauge3');
var gauge3 = new Gauge(target3).setOptions(opts3);
gauge3.maxValue = 100;
gauge3.setMinValue(0);
gauge3.animationSpeed = 32;


function atualizarValorCPU(valor) {
    gauge1.set(valor);
    document.getElementById('uso_atual1').innerHTML = valor + '<b> % CPU </b>';
}

function atualizarValorRAM(valor) {
    gauge2.set(valor);
    document.getElementById('uso_atual2').innerHTML = valor + '<b> % RAM </b>';
}

function atualizarValorDisco(valor) {
    gauge3.set(valor);
    document.getElementById('uso_atual3').innerHTML = valor + '<b> % Disco </b>';
}

const pegarProcesso = () => {
    fetch(`http://localhost:3000/pegarProcesso/${idGrafico}`, {
        method: "GET"
    })
    .then(resposta => resposta.json())
    .then(dados => {
        let tdProcessoTop3 = document.getElementById("nova_tabela_processos_top3");
        tdProcessoTop3.innerHTML = "";
        
        if (dados.length > 0) {
    
            let tabelaHTML = ""; 
           
            dados.slice(0, 3).forEach(processo => { 
        
                const dadosProcesso = processo.dado.split(', '); 
                const usoMemoria = dadosProcesso[0].split(': ')[1];
                const usoCPU = dadosProcesso[1].split(': ')[1]; 
                const status = processo.desativar;
        
                tabelaHTML += `<tr>
                    <td>${processo.pid}</td>
                    <td>${usoMemoria}</td>
                    <td>${usoCPU}</td>
                </tr>`;
            });
            
    
            tdProcessoTop3.innerHTML = tabelaHTML;
        } else {

            tdProcessoTop3.innerHTML = "<tr><td colspan='3'>Nenhum processo encontrado.</td></tr>";
        }
    })
    .catch(error => {
        console.error('Erro ao buscar dados do processo:', error);
        let tdProcessoTop3 = document.getElementById("nova_tabela_processos_top3");
        tdProcessoTop3.innerHTML = "<tr><td colspan='3'>Erro ao buscar dados do processo.</td></tr>";
    });
};

const pegarProcessoTop10 = () => {
    fetch(`http://localhost:3000/pegarProcesso/${idGrafico}`, {
        method: "GET"
    })
    .then(resposta => resposta.json())
    .then(dados => {
        let tdProcessoTop10 = document.getElementById("nova_tabela_processos_top10");

        tdProcessoTop10.innerHTML = "";

        if (dados.length > 0) {
    
            let tabelaHTML = "";
            
    
            dados.forEach(processo => {
        
                const dadosProcesso = processo.dado.split(', ');
                const usoMemoria = dadosProcesso[0].split(': ')[1]; 
                const usoCPU = dadosProcesso[1].split(': ')[1]; 
                const status = processo.desativar; 
                
                
                tabelaHTML += `<tr>
                    <td>${processo.pid}</td>
                    <td>${usoMemoria}</td>
                    <td>${usoCPU}</td>
                    <td>${processo.pid !== '0' ? `<button class="button_stop_processo" onclick="pararProcesso(${processo.pid})">Stop</button>` : ''}</td>
                </tr>`;
            });
            
            tdProcessoTop10.innerHTML = tabelaHTML;
        } else {
    
            tdProcessoTop10.innerHTML = "<tr><td colspan='4'>Nenhum processo encontrado.</td></tr>";
        }
    })
    .catch(error => {
        console.error('Erro ao buscar dados do processo:', error);
        let tdProcessoTop10 = document.getElementById("nova_tabela_processos_top10");
        tdProcessoTop10.innerHTML = "<tr><td colspan='4'>Erro ao buscar dados do processo.</td></tr>";
    });
};

const pararProcesso = (pid) => {
    let idMaquina = sessionStorage.getItem('ID_MAQUINA');
    fetch(`http://localhost:3000/pararProcesso/${idMaquina}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        pid: pid,
                    })
                }).then(function (resposta) {
                    if (resposta.ok) {
                        Swal.fire({
                            title: 'Processo Parado!',
                            icon: 'success',
                            confirmButtonText: 'Ok'
                        })
                        pegarProcessoTop10()
                
                    } else {
                        Swal.fire({
                            title: 'Erro ao parar processo!',
                            icon: 'error',
                            confirmButtonText: 'Ok'
                        })
                    }

                }).catch(erro => console.log(erro))
}
function fetchDataAndUpdateCharts() {
    plotarGraficos(idGrafico);
    setTimeout(pegarProcesso, 500);
    setTimeout(pegarProcessoTop10, 500);
}

setInterval(fetchDataAndUpdateCharts, 10000);

function mostrarTotalMaquinas() {
try {
    fetch(`http://localhost:3000/totalMaquinas/${idDarkStore}`, {
        method: "GET",
        headers: {
            "Content-Type": "application/json"
        }
    }).then(function(resposta) {
        if (!resposta.ok) {
            console.log("erro nos dados" + resposta);
        } else {
            return resposta.json();
        }
    }).then(dados => {
    
        dados['resposta'].forEach(item => {
            total_maquinas.innerHTML = `${item.total_maquinas}`
        });
    }).catch(error => {
        console.log('Erro ao processar os dados:', error);
    });
} catch (erro) {
    console.log(erro)
}
}
// }


const cadastrarSlack = () => {
    let codigo =inputCadastroSlack.value

    if(codigo === "") {
        Swal.fire({
                            title: 'Campo vazio!',
                            icon: 'error',
                            confirmButtonText: 'Ok'
                        })
    }else {
        fetch(`http://localhost:3000/cadastrarSlack/${idDarkStore}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        codigo: codigo,
                    })
                }).then(function (resposta) {
                    if (resposta.ok) {
                        Swal.fire({
                            title: 'Slack cadastrado!',
                            icon: 'success',
                            confirmButtonText: 'Ok'
                        })
            
                        setTimeout(() => {
                        location.href = "dash.html";
                    }, 2000);
                
                    } else {
                        Swal.fire({
                            title: 'Erro ao cadastrar Slack',
                            icon: 'error',
                            confirmButtonText: 'Ok'
                        })
                    }

                }).catch(erro => console.log(erro))
    }
}
function mostrarMetricas () {

fetch(`http://localhost:3000/metricas/${idDarkStore}`, {
    method: "GET",
    headers: {
        "Content-Type": "application/json"
    }
}).then(resposta => resposta.json())
    .then(value => {

        conteudo_metricas.innerHTML = "";
        value['resposta'].map(item => {

            conteudo_metricas.innerHTML += `
        <div class="funcionario">
            <div class="id">
                <p>${item.idMetricaIdeal}</p>
            </div>
            <div class="alerta">
                <p>${item.alertaCPU}</p>
            </div>
            <div class="critico">
                <p>${item.criticoCPU}</p>
            </div>
            <div class="excluir">
                <i onclick="excluirMetrica(${item.idMetricaIdeal})" class="fa fa-trash-o"
                    style="font-size:24px; display: flex; align-items: center;"></i>
            </div>
            <div class="editar">
                <i onclick="openEditarMetricas(${item.idMetricaIdeal})" class="fa fa-edit" style="font-size:24px; display: flex; align-items: center;"></i>
            </div>
        </div>
        `
        })
    })
}
function cadastrarMetricas() {
    
    const alerta = input_alertaMetrica.value
    const critico = input_criticoMetrica.value

    if (alerta === '' || critico === "") {
        Swal.fire({
            color: "#ffffff",
            background: "#272628",
            confirmButtonColor: "#8039EB",
            icon: "error",
            title: "Oops...",
            text: "Preencha todos os campos",
        });
        return false
    } else {
        fetch(`http://localhost:3000/cadastroMetricas/${idDarkStore}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                alerta: alerta,
                critico: critico,
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                Swal.fire({
                    title: 'Cadastrado!',
                    icon: 'success',
                    confirmButtonText: 'Ok'
                })
                mostrarMetricas()
            } else {
                Swal.fire({
                    title: 'Erro ao cadastrar',
                    icon: 'error',
                    confirmButtonText: 'Ok'
                })
            }
        }).catch(erro => console.log(erro))
    }
}
function excluirMetrica(idMetricaIdeal) {
    fetch(`http://localhost:3000/deletarMetrica/${idMetricaIdeal}`, {
        method: "DELETE",
        headers : {
            "Content-type" : "application/json"
        }
    })
    .then(response => {
        if (response.ok) {
            Swal.fire({
                    title: 'Métrica excluida!',
                    icon: 'success',
                    confirmButtonText: 'Ok'
                })
                mostrarMetricas()
        } else {
            Swal.fire({
                    confirmButtonText: 'Ok',
                    icon: "error",
                    title: "Erro ao excluir métrica",
                });
        }
    })
    .catch(error => console.error("Erro:", error));
}
const editarMetricasOk = () => {
        let alerta = alerta_input_metricas.value
        let critico = critico_input_metricas.value

        if (alerta === "" || critico === "") {
            Swal.fire({
                title: 'Campos vazios',
                icon: 'error',
                confirmButtonText: 'Ok'
            })
        } else {
                fetch(`http://localhost:3000/atualizarMetrica/${idMetricas}`,
                    {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            alerta: alerta,
                            critico: critico,
                        })
                    }).then(function (resposta) {
                        if (!resposta.ok) {
                            Swal.fire({
                                title: 'Alterado!',
                                icon: 'success',
                                confirmButtonText: 'Ok'
                            })
                        mostrarMetricas()
                        } else {
                            Swal.fire({
                                title: 'Erro ao alterar',
                                icon: 'error',
                                confirmButtonText: 'Ok'
                            })
                        }

                    }).catch(erro => console.log(erro))
            }
        }
</script>
<!-- <script src="./js/plotarGrafico.js" defer></script>
<script src="./js/graficos.js" defer></script> -->
<script>
    function openCadastrarSlack() {
        if (cargo === "" || cargo === "gerente") {
            cadastrarSlack_div.style.display = "flex"
        } else {
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Sem autorização necessaria"
            });
        }
    }

    function exitCadastrarSlack() {
        cadastrarSlack_div.style.display = "none"
    }

    function openListaFuncionarios() {
        listaFuncionarios.style.display = "flex"
    }
    
    function openListaMetricas() {
        listaMetricas.style.display = "flex"
    }
    function exitListaMetricas() {
        listaMetricas.style.display = "none"
    }

    function openListaMaquinas() {
        listaMaquinas.style.display = "flex"
        mostrarMaquina();
    
    }

    function exitListaMaquinas() {
        listaMaquinas.style.display = "none"
    }

    // function openEditarMaquinas() {
    //     editarMaquinas.style.display = "flex"
        
    // }

    function exitEditarMaquinas() {
        editarMaquinas.style.display = "none"
    }

    function openPerfil() {
        abrirPerfil.style.display = "flex"
    }

    function exitPerfil() {
        abrirPerfil.style.display = "none"
    }

    function exitPerfilOk() {
        editarPerfil.style.display = "none"
        abrirPerfil.style.display = "none"
    }

    function exitListaFuncionarios() {
        listaFuncionarios.style.display = "none"
    }

    function openCadastroFuncionarios() {
        cadastroFuncionarios.style.display = "flex"
    }
  
    function openCadastroMetricas() {
        cadastroMetricas.style.display = "flex"
    }

    function exitCadastroFuncionarios() {
        cadastroFuncionarios.style.display = "none"
    }
 
    function exitCadastroMetricas() {
        cadastroMetricas.style.display = "none"
    }


    function openEditarPerfil() {

        email_input_perfil.value = localStorage.EMAIL;
        editarPerfil.style.display = "flex"
    }

    function exitEditarFuncionarios() {
        editarFuncionarios.style.display = "none"
    }
    
    function openListaDark() {
        listaDark.style.display = "flex"
        exibirListaDark()
    }
    
    function exitListaDark() {
        listaDark.style.display = "none"
    }
    function openCadastrarDark() {
        div_cadastro_darkStore.style.display = "flex"
    }
    function exitCadastroDark() {
        div_cadastro_darkStore.style.display = "none"
    }
    function exitEditarDark() {
        div_editar_darkStore.style.display = "none"
    }
    function openProcessos() {
        div_listar_processos.style.display = 'flex'
    }
    function closeProcessos() {
        div_listar_processos.style.display = 'none'
    }

    // function abrirModal() {
    //     switch (key) {
    //         case 1:
                
    //             break;
        
    //         default:
    //             break;
    //     }
    // }
    function exitEditarMetricas() {
        editarMetricas.style.display = 'none'
    }
</script>
<script defer>

var ctx1 = document.getElementById('lineChart1').getContext('2d');
var lineChart1 = new Chart(ctx1, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Registros CPU',
            data: [],
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            fill: true
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true,
                    min: 0,
                    max: 20,
                    stepSize: 5
                }
            }]
        }
    }
});


var ctx2 = document.getElementById('lineChart2').getContext('2d');
var lineChart2 = new Chart(ctx2, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Registros DISCO',
            data: [],
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            fill: true
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true,
                    min: 0,
                    max: 20,
                    stepSize: 5
                }
            }]
        }
    }
});


// Gráfico da RAM
var ctx3 = document.getElementById('lineChart3').getContext('2d');
var lineChart3 = new Chart(ctx3, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Registros RAM',
            data: [],
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            fill: true
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true,
                    min: 35,
                    max: 50,
                    stepSize: 5
                }
            }]
        }
    }
});
var ctx4 = document.getElementById('donutChart').getContext('2d');
var donutChart = new Chart(ctx4, {
    type: 'doughnut',
    data: {

        datasets: [{
            label: 'Disco',
            data: [0, 100], 
            backgroundColor: ['rgba(54, 122, 235, 0.8)', 'rgba(153, 42, 255, 0.8)'],
            hoverBackgroundColor: ['#FF6384', '#36A2EB']
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        cutoutPercentage: 70, 
        animation: {
            animateScale: true,
            animateRotate: true
        }
    }
});
</script>